@use "sass:color";
@use "../abstracts/_variables" as *;

$overgrid-border-color: rgba(255, 255, 255, 0.8);

.sudoku-page {
  background: linear-gradient(to bottom, #000, $secondary-color);
  color: $primary-color;
  min-height: 100vh;
  padding: 100px 0 50px;

  @media (max-width: 768px) {
    padding: 50px 0 25px;
  }

  .sudoku-container {
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 35px;

      @media (max-width: 768px) {
        padding: 0 15px;
      }
    }

    .start-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%; // Matches .sudoku-grid width
      height: 100%; // Matches .sudoku-grid height
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;

      .start-message {
        background: $secondary-color;
        padding: clamp(15px, 3vw, 20px);
        border-radius: 8px;
        text-align: center;
        max-width: 90%;
        color: $primary-color;

        h2 {
          font-size: clamp(20px, 4vw, $font-xl);
          margin-bottom: 10px;
          color: $accent-color;
        }

        p {
          font-size: clamp(12px, 2.5vw, $font-sm);
          margin-bottom: 15px;
        }
      }
    }

    h2 {
      font-size: clamp(24px, 5vw, $font-xxl);
      line-height: 1.2;
      margin-bottom: 1rem;
      color: $primary-color;
      text-shadow: none;
      font-family: $header-font;

      @media (max-width: 768px) {
        margin-bottom: 0.75rem;
      }
    }

    .supporting-text {
      font-size: clamp(12px, 2.5vw, $font-sm);
      font-style: italic;
      text-align: left;
      padding-left: 1rem;
      border-left: 4px solid $accent-color;
      margin-bottom: 2rem;
      max-width: 600px;
      color: #ddd;
      font-family: $body-font;

      @media (max-width: 768px) {
        margin-bottom: 1.5rem;
      }
    }

    .sudoku-layout {
      display: flex;
      gap: 30px;
      justify-content: center;
      align-items: flex-start;

      .sudoku-grid  {
        position: relative;
      }

      @media (max-width: 768px) {
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }
    }

    .controls-column {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;

      @media (max-width: 768px) {
        width: 100%;
      }
    }

    .sudoku-controls {
      display: flex;
      flex-direction: column;
      gap: 3rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 10px;
      border-radius: 8px;

      @media (max-width: 768px) {
        gap: 8px;
        padding: 8px;
        width: 100%;
      }

      .control-row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;

        .timer {
          font-size: $font-sm;
          color: $primary-color;
          padding: 8px;
          font-family: $body-font;
          min-width: 50px;
        }

        @media (max-width: 768px) {
          gap: 8px;
          flex-direction: column;
          align-items: flex-start;
        }
      }

      label {
        font-size: $font-sm;
        color: $primary-color;
        font-family: $body-font;

        @media (max-width: 768px) {
          margin-bottom: 5px;
        }
      }

      .sudoku-select {
        padding: 8px 32px 8px 16px;
        font-size: $font-sm;
        font-family: $body-font;
        background: var(--accent-color);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 7px;
        color: $primary-color;
        transition: background-color 0.3s ease;
        min-width: 100px;

        &:hover,
        &:focus {
          background: var(--accent-color-light);
          outline: none;
        }
      }

      .mistake-counter {
        display: flex;
        gap: 6px;
        padding: 8px;

        .dot {
          width: 10px;
          height: 10px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.3);
          transition: background-color 0.3s ease;

          &.filled {
            background: var(--highlight-color);
          }
        }
      }

      .cta-button {
        background: $accent-color;
        border: 1px solid rgba(255, 255, 255, 0.5);
        min-width: 100px;

        &:hover {
          background: $accent-color-light;
        }
      }

      .auto-candidates-checkbox {
        margin-left: 10px;
        accent-color: $accent-color; // Teal checkbox for consistency
        cursor: pointer;

        &:hover {
          opacity: 0.8;
        }
      }
    }

    .sudoku-grid {
      display: grid;
      grid-template-columns: repeat(9, clamp(40px, 8vw, 75px));
      grid-gap: 4px;
      background: rgba(0, 0, 0, 0.8);
      padding: 6px;
      width: fit-content;
      border-radius: 8px;
      position: relative;
    }

    .number-status-grid {
      display: grid;
      grid-template-columns: repeat(3, clamp(40px, 6vw, 60px));
      grid-gap: 4px;
      background: rgba(0, 0, 0, 0.8);
      padding: 6px;
      border-radius: 8px;
    }

    .cell {
      position: relative;
      width: clamp(40px, 8vw, 75px);
      height: clamp(40px, 8vw, 75px);
      background: rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(16px, 2.5vw, 20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: default;
    
      &:hover {
        background: rgba(255, 255, 255, 0.25);
      }
    
      &[contenteditable="true"] {
        caret-color: transparent;
      }
    
      &[contenteditable="true"]:focus {
        outline: none;
        border: 2px solid #fff;
        background: rgba(var(--highlight-color-rgb), 0.3); // Magenta, lighter
      }

      &.invalid {
        color: $highlight-color; // #BF3978 (pink)
        transition: color 0.3s ease; // Smooth fade-out
      }
    
      &.notes {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 2px !important;
        padding: 2px !important;
        font-size: clamp(10px, 1.5vw, 12px) !important;
        background: rgba(255, 255, 255, 0.15) !important;
    
        span {
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: inherit !important;
          color: #ff69b4 !important;
          background: transparent !important;
        }
      }

      &:nth-child(3n+1) {
        border-left: 1px solid $overgrid-border-color;
      }

      &:nth-child(3n) {
        border-right: 1px solid $overgrid-border-color;
      }

      &:nth-child(-n+9) {
        border-top: 1px solid $overgrid-border-color;
      }

      &:nth-child(n+19):nth-child(-n+27),
      &:nth-child(n+46):nth-child(-n+54) {
        border-bottom: 1px solid $overgrid-border-color;
      }

      &:nth-last-child(-n+9) {
        border-bottom: 1px solid $overgrid-border-color;
      }

      &.invalid {
        color: var(--highlight-color);
        transition: color 0.3s ease;
      }

      &.highlighted {
        background: rgba(var(--accent-color-rgb), 0.5);
      }
    }

    .notes-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      padding: 2px;
      border-radius: 5px;
      z-index: 10;
    

      .note-option {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(10px, 1.5vw, 14px);
        color: transparent; // Hidden by default
        cursor: pointer;
        transition: color 0.4s ease; // Slower transition for color only

        &:hover {
          color: #ff69b4; // Pink on hover (matches permanent notes)
          background: transparent; // No background fill
        }

        &.selected {
          color: #ff69b4; // Pink when selected
          background: transparent; // No background fill
        }

        &.selected:hover {
          color: #ff69b4; // Remains pink (no change needed)
          background: transparent; // No background fill
        }
      }
    }
    
    .number-cell {
      width: clamp(40px, 6vw, 60px);
      height: clamp(40px, 6vw, 60px);
      background: rgba(var(--accent-color-rgb), 0);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 1px;
      font-size: clamp(16px, 2.5vw, 24px);
      font-family: $body-font;
      color: $primary-color; // #fff (default)
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: border-color 0.3s ease, color 0.3s ease;
      position: relative;

      .number-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
        transition: color 0.3s ease;
      }

      .segment {
        background: rgba(var(--accent-color-rgb), 0.2);
        transition: background-color 0.3s ease;
      }

      .segment.filled {
        background: rgba(var(--accent-color-rgb), 0.8);
      }

      &:hover {
        border-color: var(--accent-color);
      }

      &.solved {
        color: $solved-color; // #999 for completion
        .number-text {
          color: $solved-color; // Ensure text matches
        }
      }

      &.noted {
        opacity: 0.7;
      }
    }

    .highlight {
      background: rgba(var(--accent-color-rgb), 0.4);
    }

    .thinking-type {
      opacity: 0;
      animation: typeIn 0.3s ease-out forwards;
    }

    .game-over-overlay,
    .success-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;

      .game-over-message,
      .success-message {
        background: $secondary-color;
        padding: clamp(15px, 3vw, 20px);
        border-radius: 8px;
        text-align: center;
        max-width: 90%;

        h2 {
          font-size: clamp(20px, 4vw, $font-xl);
          margin-bottom: 10px;
          color: var(--highlight-color);
          &.success-message h2 { color: var(--accent-color); }
        }

        p {
          font-size: clamp(12px, 2.5vw, $font-sm);
          color: $primary-color;
          margin-bottom: 15px;
        }

        .cta-button {
          background: $accent-color;
          border: none;
          padding: 10px 20px;
          font-size: clamp(12px, 2.5vw, $font-sm);

          &:hover {
            background: $accent-color-light;
          }
        }
      }
    }
  }

  @keyframes successFlash {
    0% { background: rgba(0, 0, 0, 0.8); }
    50% { background: rgba(var(--accent-color-rgb), 0.3); }
    100% { background: rgba(0, 0, 0, 0.8); }
  }

  @keyframes typeIn {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
  }
}